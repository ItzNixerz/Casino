<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Plinko Game</title>
    <style>
        /* Reset default margin and padding */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #1e1e1e; /* Same as Blackjack background */
            color: #fff;
            text-align: center;
            display: flex;
            justify-content: space-between;
            min-height: 100vh;
        }

        /* Sidebar (Chat) */
        #chat {
            width: 250px;
            height: 100%;
            background-color: #333;
            color: white;
            padding: 20px;
            overflow-y: auto;
            border-radius: 10px;
            margin-right: 30px;
        }

        #chat h3 {
            text-align: center;
        }

        #chat ul {
            list-style-type: none;
            padding-left: 0;
        }

        #chat li {
            margin-bottom: 10px;
            padding: 5px;
            background-color: #444;
            border-radius: 5px;
        }

        /* Game Board */
        #game-board {
            position: relative;
            width: 70%; /* Set the width to a fixed percentage */
            height: 500px; /* Fixed height for the board */
            margin: 30px auto;
            background-color: #f0f0f0;
            border: 2px solid #000;
            border-radius: 10px;
            overflow: hidden;
        }

        /* Pegs */
        .peg {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #333;
            border-radius: 50%;
        }

        /* Ball */
        .ball {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: red; /* Red Ball */
            border-radius: 50%;
        }

        /* Bins at the bottom */
        .bin {
            width: 40px;
            height: 30px;
            background-color: #4CAF50;
            border-radius: 10px;
            position: absolute;
            bottom: 0;
            color: white;
            font-size: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Button */
        #spawn-ball-btn {
            padding: 10px;
            background-color: #333;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <!-- Sidebar for Chat -->
    <div id="chat">
        <h3>Ball Landing Chat</h3>
        <ul id="chat-list">
            <!-- Landing information will be appended here -->
        </ul>
    </div>

    <!-- Game Board Section -->
    <div id="game-board"></div>

    <!-- Spawn Ball Button -->
    <button id="spawn-ball-btn">Spawn Ball</button>

    <script>
        const board = document.getElementById("game-board");
        const spawnBallBtn = document.getElementById("spawn-ball-btn");
        const chatList = document.getElementById("chat-list");
        let rows = 5; // Default rows
        let bins = []; // Array to hold bins
        const landingHistory = []; // Store landing history (max 20 entries)

        // Function to generate the pegs
        function createPegs() {
            board.innerHTML = ''; // Clear the board

            // Variables for the position of pegs
            const pegDistance = 40;
            const width = board.offsetWidth;

            // Pegs grid generation logic (narrow at the top and wide at the bottom)
            for (let y = 0; y < rows; y++) {
                let pegOffsetX = (width - pegDistance * (y + 1)) / 2; // make top narrow
                for (let x = 0; x <= y; x++) {
                    const peg = document.createElement('div');
                    peg.classList.add('peg');
                    peg.style.top = `${y * pegDistance}px`;
                    peg.style.left = `${pegOffsetX + (x * pegDistance)}px`;
                    board.appendChild(peg);
                }
            }
            createBins(); // Regenerate bins based on row count
        }

        // Function to create bins at the bottom with multipliers
        function createBins() {
            bins = [];
            const width = board.offsetWidth;
            const binWidth = 40;
            const binHeight = 30;

            const totalBins = rows + 1;
            let multipliers;

            // Set multipliers for different row counts
            if (rows === 5) {
                // For 5 rows: 2x at the outer bins, 1x in the middle bins, and 0.2x in the center
                multipliers = [2, 1, 1, 1, 0.2];
            } else if (rows === 16) {
                // For 16 rows: outer bins 1000x, 50x, 25x, 10x, 2x, 0.2x in the middle
                multipliers = [1000, 50, 25, 10, 2, 0.2];
            } else {
                // Default multipliers for any other rows count (this could be expanded or adjusted as needed)
                multipliers = Array(totalBins).fill(0.2); // Default all bins to 0.2x
            }

            // Create bins centered at the bottom of the board
            for (let i = 0; i < totalBins; i++) {
                const bin = document.createElement('div');
                bin.classList.add('bin');
                bin.style.left = `${(width - (binWidth * totalBins)) / 2 + (i * binWidth)}px`;
                bin.style.width = `${binWidth}px`;
                bin.style.height = `${binHeight}px`;

                // Assign a multiplier to each bin
                const multiplier = multipliers[i % multipliers.length];
                bin.textContent = `${multiplier}x`;

                bins.push(bin);
                board.appendChild(bin);
            }
        }

        // Function to drop a ball
        function dropBall() {
            const ball = document.createElement('div');
            ball.classList.add('ball');
            ball.style.left = `${(board.offsetWidth - 20) / 2}px`;  // Ball starts at the center
            ball.style.top = '0px';

            board.appendChild(ball);

            let positionX = (board.offsetWidth - 20) / 2;  // Initial X
            let positionY = 0;  // Initial Y (top)
            let gravity = 2;  // Ball falling speed

            function moveBall() {
                if (positionY < board.offsetHeight - 30) {
                    positionY += gravity;
                    ball.style.top = `${positionY}px`;

                    // Add random left or right movement to simulate bouncing off pegs
                    if (Math.random() < 0.1) {
                        positionX += Math.random() < 0.5 ? -20 : 20;
                    }

                    ball.style.left = `${positionX}px`;

                    requestAnimationFrame(moveBall);
                } else {
                    // Ball reaches the bottom
                    const binIndex = Math.floor((positionX - 10) / 40);

                    if (binIndex >= 0 && binIndex < bins.length) {
                        const multiplier = bins[binIndex].textContent;
                        logBallLanding(multiplier);  // Log landing in chat
                    }

                    // Remove the ball after landing
                    setTimeout(() => {
                        ball.remove();
                    }, 500);
                }
            }

            moveBall();
        }

        // Log ball landing in the chat
        function logBallLanding(multiplier) {
            const landingMessage = `Ball landed in a bin with multiplier: ${multiplier}`;
            if (landingHistory.length >= 20) {
                landingHistory.shift(); // Remove the oldest if we have more than 20 entries
            }

            landingHistory.push(landingMessage);

            // Update chat display
            updateChat();
        }

        // Update the chat with the latest 20 landings
        function updateChat() {
            chatList.innerHTML = '';
            landingHistory.forEach(landing => {
                const li = document.createElement('li');
                li.textContent = landing;
                chatList.appendChild(li);
            });
        }

        // Add event listener to spawn ball button
        spawnBallBtn.addEventListener("click", dropBall);

        // Initialize the game
        createPegs();
        createBins();

    </script>

</body>
</html>
